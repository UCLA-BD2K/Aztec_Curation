<!DOCTYPE html>
<html>
<head>
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title><%=title%></title>
  <link rel="stylesheet" type="text/css" href="//maxcdn.bootstrapcdn.com/bootstrap/3.3.4/css/bootstrap.min.css">
  <link rel="stylesheet" href="/stylesheets/register/ng-tags-input.min.css">
  <link href="/stylesheets/index.css" rel="stylesheet">
  <script src="//code.jquery.com/jquery-2.1.4.min.js"></script>
  <script src="/javascripts/register/validator.js"></script>
    <link rel="stylesheet" type="text/css" href="/stylesheets/register/styles.css">

  <script>
    var current_sec = '#part1';
    $(window).load(function() {
	$(".page-loader").fadeOut("slow");
})
    $(document).ready(function() {

      $('#b1next').on('click', function() {
        $('#part1').hide();
        $('#part2').show();
        current_sec = '#part2';
      });
      $('#b2prev').on('click', function() {
        $('#part2').hide();
        $('#part1').show();
        current_sec = '#part1';
      });
      $('#b2next').on('click', function() {
        $('#part2').hide();
        $('#part3').show();
        current_sec = '#part3';
      });
      $('#b3prev').on('click', function() {
        $('#part3').hide();
        $('#part2').show();
        current_sec = '#part2';
      });
      $('#b3next').on('click', function() {
        $('#part3').hide();
        $('#part4').show();
        current_sec = '#part4';
      });
      $('#b4prev').on('click', function() {
        $('#part4').hide();
        $('#part3').show();
        current_sec = '#part3';
      });
      $('#b4next').on('click', function() {
        $('#part4').hide();
        $('#part5').show();
        current_sec = '#part5';
      });
      $('#b5prev').on('click', function() {
        $('#part5').hide();
        $('#part4').show();
        current_sec = '#part4';
      });
      $('#b5next').on('click', function() {
        $('#part5').hide();
        $('#part6').show();
        current_sec = '#part6';
      });
      $('#b6prev').on('click', function() {
        $('#part6').hide();
        $('#part5').show();
        current_sec = '#part5';
      });
      $('#b6next').on('click', function() {
        $('#part6').hide();
        $('#part7').show();
        current_sec = '#part7';
      });
      $('#b7prev').on('click', function() {
        $('#part7').hide();
        $('#part6').show();
        current_sec = '#part6';
      });
      $('#b7next').on('click', function() {
        $('#part7').hide();
        $('#part8').show();
        current_sec = '#part8';
      });
      $('#b8prev').on('click', function() {
        $('#part8').hide();
        $('#part7').show();
        current_sec = '#part7';
      });
      $('#b8next').on('click', function() {
        $('#part8').hide();
        $('#part9').show();
        current_sec = '#part9';
      });
      $('#b9prev').on('click', function() {
        $('#part9').hide();
        $('#part8').show();
        current_sec = '#part8';
      });


      $('#pre1').on('click', function() {
        $(current_sec).hide();
        $('#part1').show();
        current_sec = '#part1';
      });
      $('#pre2').on('click', function() {
        $(current_sec).hide();
        $('#part2').show();
        current_sec = '#part2';
      });
      $('#pre3').on('click', function() {
        $(current_sec).hide();
        $('#part3').show();
        current_sec = '#part3';
      });
      $('#pre4').on('click', function() {
        $(current_sec).hide();
        $('#part4').show();
        current_sec = '#part4';
      });
      $('#pre5').on('click', function() {
        $(current_sec).hide();
        $('#part5').show();
        current_sec = '#part5';
      });
      $('#pre6').on('click', function() {
        $(current_sec).hide();
        $('#part6').show();
        current_sec = '#part6';
      });
      $('#pre7').on('click', function() {
        $(current_sec).hide();
        $('#part7').show();
        current_sec = '#part7';
      });
      $('#pre8').on('click', function() {
        $(current_sec).hide();
        $('#part8').show();
        current_sec = '#part8';
      });
      $('#pre9').on('click', function() {
        $(current_sec).hide();
        $('#part9').show();
        current_sec = '#part9';
      });
      var temp = ($(document).width())* 0.024 ;
      var margin = temp.toString();
      margin = margin + "%";
      $("#registerHeading").css("margin-right", margin);

       $(window).resize(function(){
       var tm = ($(document).width())* 0.024  ;
      var winm = tm.toString();
      winm = winm + "%";
      $("#registerHeading").css("margin-right", winm);

         });
      <% if(title  !='Register') { %>
        // $('#save').css("color", "transparent");
        // $('#save').css("background-color", "transparen/t");
        $('#save').css("visibility", "hidden");
      <% } %>

 });

    // End of Jquery 
  document.getElementById("copyButton").addEventListener("click", function() {
    copyToClipboard(document.getElementById("copyTarget"));
});

function copyToClipboard(elem) {
    // create hidden text element, if it doesn't already exist
    var targetId = "_hiddenCopyText_";
    var isInput = elem.tagName === "INPUT" || elem.tagName === "TEXTAREA";
    var origSelectionStart, origSelectionEnd;
    if (isInput) {
        // can just use the original source element for the selection and copy
        target = elem;
        origSelectionStart = elem.selectionStart;
        origSelectionEnd = elem.selectionEnd;
    } else {
        // must use a temporary form element for the selection and copy
        target = document.getElementById(targetId);
        if (!target) {
            var target = document.createElement("textarea");
            target.style.position = "absolute";
            target.style.left = "-9999px";
            target.style.top = "0";
            target.id = targetId;
            document.body.appendChild(target);
        }
        target.textContent = elem.textContent;
    }
    // select the content
    var currentFocus = document.activeElement;
    target.focus();
    target.setSelectionRange(0, target.value.length);
    
    // copy the selection
    var succeed;
    try {
        succeed = document.execCommand("copy");
    } catch(e) {
        succeed = false;
    }
    // restore original focus
    if (currentFocus && typeof currentFocus.focus === "function") {
        currentFocus.focus();
    }
    
    if (isInput) {
        // restore prior selection
        elem.setSelectionRange(origSelectionStart, origSelectionEnd);
    } else {
        // clear temporary content
        target.textContent = "";
    }
    return succeed;
}

  </script>
  <style>
    pre:hover {
      background-color: rgba(0, 0, 0, 0.05);
    }

    .repeat_section {
      margin-top: 25px
    }
  </style>
</head>

<body ng-app="Aztec" ng-controller="MainController as vm" <%= init %> >
  <%- include ./partials/header.ejs %>

  <div class='fstrow'>
      <div class="page-loader"></div>
    <div class="breadcrumbs">
      <h2> <a href="/home"> HOME </a> > <a href="/reg"> REGISTER NEW RESOURCE </a> >  </h2>
    </div>
    <div class= "titlestuff">
      <h1 class="reg-h1" id="registerHeading"><%=heading%></h1>

        <button id='save' class="btn btn-primary" ng-click="vm.beforeSaveCheck()" data-toggle="modal" data-target="#saveModal">Save</button>

        <button id='submit' class="btn btn-primary" ng-click="vm.checkForm()" data-toggle="modal" data-target="#submitModal">  <a href="javascript:grecaptcha.reset();">Submit</a></button>

     </div>
  </div>

<div class = "container" id="overall">


  <div class="row">

    <!-- The main form -->

    <div class="container col-md-7">
      <form data-toggle="validator" novalidate>
        <div id='part1'>
          <h1>Basic Information</h1>
          <formly-form model="vm.basic" fields="vm.basicFields" form="vm.basicForm">
          </formly-form>
          <div class="row text-center">
            <button id='b1next' class="btn btn-success">Next</button>
          </div>
        </div>
        <div id='part2' style='display:none'>
          <h1>Authors</h1>
          <formly-form model="vm.authors" fields="vm.authorFields" form="vm.authorForm">
          </formly-form>
          <div class="row text-center">
            <button id='b2prev' class="btn btn-success">Prev</button>
            <button id='b2next' class="btn btn-success">Next</button>
          </div>
        </div>
        <div id='part3' style='display:none'>
          <h1>Publications</h1>
          <formly-form model="vm.publication" fields="vm.pubFields" form="vm.pubForm">
          </formly-form>
          <div class="row text-center">
            <button id='b3prev' class="btn btn-success">Prev</button>
            <button id='b3next' class="btn btn-success">Next</button>
          </div>
        </div>
        <div id='part4' style='display:none'>
          <h1>Links</h1>
          <formly-form model="vm.links" fields="vm.linkFields" form="vm.linksForm">
          </formly-form>
          <div class="row text-center">
            <button id='b4prev' class="btn btn-success">Prev</button>
            <button id='b4next' class="btn btn-success">Next</button>
          </div>
        </div>
        <div id='part5' style='display:none'>
          <h1>Development</h1>
          <formly-form model="vm.dev" fields="vm.devFields" form="vm.devForm">
          </formly-form>
          <div class="row text-center">
            <button id='b5prev' class="btn btn-success">Prev</button>
            <button id='b5next' class="btn btn-success">Next</button>
          </div>
        </div>
        <div id='part6' style='display:none'>
          <h1>Version History</h1>
          <formly-form model="vm.version" fields="vm.versionFields" form="vm.versionForm" options="vm.versionOptions">
          </formly-form>
          <div class="row text-center">
            <button id='b6prev' class="btn btn-success">Prev</button>
            <button id='b6next' class="btn btn-success">Next</button>
          </div>
        </div>
        <div id='part7' style='display:none'>
          <h1>I/O (coming soon)</h1>
          <formly-form model="vm.io" fields="vm.ioFields" form="vm.ioForm">
          </formly-form>
          <div class="row text-center">
            <button id='b7prev' class="btn btn-success">Prev</button>
            <button id='b7next' class="btn btn-success">Next</button>
          </div>
        </div>
        <div id='part8' style='display:none'>
          <h1>Licenses</h1>
          <formly-form model="vm.license" fields="vm.licenseFields" form="vm.licenseForm">
          </formly-form>
          <div class="row text-center">
            <button id='b8prev' class="btn btn-success">Prev</button>
            <button id='b8next' class="btn btn-success">Next</button>
          </div>
        </div>
        <div id='part9' style='display:none'>
          <h1>Funding</h1>
          <formly-form model="vm.funding" fields="vm.fundingFields" form="vm.fundingForm">
          </formly-form>
          <div class="row text-center">
            <button id='b9prev' class="btn btn-success">Prev</button>

          </div>
        </div>
      </form>
    </div>

    <div class="container col-md-3">
      <ul class="nav nav-tabs" role="tablist">
        <li class = "active">
           <a href="#summary" role="tab" data-toggle="tab">
            Summary
           </a>
        </li>
        <li>
           <a href="#suggestor" role="tab" data-toggle="tab">
            Suggest
           </a>
        </li>
      </ul>
           <!---Tabbed stuff-->
  <div class= "tab-content">

      <div class="tab-pane fade" id="suggestor">
         <center><button class="btn btn-default" ng-click="vm.suggest()">Suggest</button></center>
         <div id='loading' style='display:none'>
          <center><img src='/images/magnify.gif'/></center>
         </div>
         <div id='suggestions' style='padding-top:1%; word-wrap: break-word;'>
          </div>
      </div>

    <div class="tab-pane fade active in" id="summary">
      <pre id='pre1'><h2 class="sum_">BASIC</h2>Name: {{vm.basic.res_name}} <br>Tags: <span ng-repeat="tag in vm.basic.tags track by $index">{{($index!=0) ? ", ":""}}{{vm.basic.tags[$index].text}}</span></pre>
      <pre id='pre2'><h2 class="sum_">AUTHORS</h2><div ng-repeat = "authors in vm.authors.authors track by $index" id = "author-repeater">Author {{$index+1}}: {{vm.authors.authors[$index].last_name}}, {{vm.authors.authors[$index].first_name}} <{{vm.authors.authors[$index].author_email}}> </div>
      </pre>
      <pre id='pre3'><h2 class="sum_">PUBLICATIONS</h2>Resource DOI: {{vm.publication.pub_tool_doi}}<br>Main Pub. DOI:{{vm.publication.pub_primary_doi}} <br>Publication DOIs: <span ng-repeat = "pub_dois in vm.publication.pub_dois track by $index" id = "pub-sec">{{($index!=0) ? ", ":""}}{{vm.publication.pub_dois[$index].pub_doi}}</span>
      </pre>
      <pre id='pre4'><h2 class="sum_">LINKS</h2><div ng-repeat = "links in vm.links.links track by $index">Name: {{vm.links.links[$index].link_name}} <br>URL: <a href="{{vm.checkLink(vm.links.links[$index].link_url)}}" class="link-link">{{vm.links.links[$index].link_url}}</a></div>
        </pre>
      <pre id='pre5'><h2 class="sum_">DEVELOPMENT</h2>Source: {{vm.dev.res_code_url}}<br>Languages: <span ng-repeat="dev_lang in vm.dev.dev_lang track by $index">{{($index!=0) ? ", ":""}}{{vm.dev.dev_lang[$index].PRIMARY_NAME}}</span><br>Platforms: <span ng-repeat="dev_platform in vm.dev.dev_platform track by $index">{{($index!=0) ? ", ":""}}{{vm.dev.dev_platform[$index].platform_name}}</span>

      </pre>
      <pre id='pre6'><h2 class="sum_">VERSIONS</h2>Latest Version: {{vm.version.latest_version}}<br>Date: {{vm.version.latest_version_date | date:'mediumDate'}}<br>Description: {{vm.version.latest_version_desc}}<div ng-repeat="prev_versions in vm.version.prev_versions track by $index">Previous version {{$index+1}}: {{vm.version.prev_versions[$index].version_number}}<br>Date: {{vm.version.prev_versions[$index].version_date | date:'mediumDate'}}<br>Description:{{vm.version.prev_versions[$index].version_description}}</div>
    </pre>
<!--       <pre id='pre7'>IO {{vm.io}}
       <div id="wrapper">
        Dependencies:
        <div ng-repeat ="dependencies in vm.io.dependencies track by $index" style="display:inline;">
          {{vm.io.dependencies[$index].text}}
        </div>
        </div>

      </pre> -->
      <pre id='pre8'><h2 class="sum_">LICENSES</h2><div ng-repeat = "licenses in vm.license.licenses track by $index">License {{$index+1}}: {{vm.license.licenses[$index].license}} </div>
        </pre>
      <pre id='pre9'><h2 class="sum_">FUNDING</h2><div ng-repeat="funding in vm.funding.funding track by $index"> Agency: {{(vm.funding.funding[$index].missing == false || vm.funding.funding[$index].missing == undefined)  ? vm.funding.funding[$index].funding_agency : vm.funding.funding[$index].new_agency}} <br> Grant: {{vm.funding.funding[$index].funding_grant}}
      </div>BD2K Center(s): <span ng-repeat="bd2k in vm.funding.bd2k track by $index">{{($index!=0) ? ", ":""}}{{vm.funding.bd2k[$index].center}}</span>
</pre>
    </div>

 </div>

    </div>


  </div>


  <div class="modal fade" id="saveModal" tabindex="-1" role="dialog" aria-labelledby="saveModalLabel">
    <div class="modal-dialog" role="document">
      <div class="modal-content">
        <div class="modal-header">
          <button type="button" class="close" data-dismiss="modal" aria-label="Close">
            <span aria-hidden="true">&times;</span>
          </button>
          <center>
            <h4 class="modal-title" id="saveModalLabel">Save</h4>
          </center>
        </div>
        <div id='pre-save'>
        </div>
        <div id='modal-save' class='modal-footer'>

          <button type='button' class='btn btn-default' ng-click='vm.save()'>Yes</button>
          <button type='button' class='btn btn-default' data-dismiss='modal'>Cancel</button>
        </div>
        <div id='modal-save-warn' class='modal-footer' style="display: none;">
          <button type='button' class='btn btn-default' data-dismiss='modal'>Okay</button>
        </div>
      </div>
    </div>
  </div>

  <div class="modal fade" id="submitModal" tabindex="-1" role="dialog" aria-labelledby="submitModalLabel">
    <div class="modal-dialog" role="document">
      <div class="modal-content">
        <div class="modal-header">
          <button type="button" class="close" data-dismiss="modal" aria-label="Close">
            <span aria-hidden="true">&times;</span>
          </button>
          <center>
            <h4 class="modal-title" id="submitModalLabel"></h4>
          </center>
        </div>
        <div id='pre-submit'>
        </div>
        <div id='modal-submit' class='modal-footer' style="display: none;">
          <div id='submit-recaptcha' class="g-recaptcha" data-sitekey="6Lc4DxYTAAAAAHqTlTb1np-XR8JKh6RYvgYvf4NQ"></div>
          <button type='button' class='btn btn-default' data-dismiss='modal'>Close</button>
          <button type='button' class='btn btn-default' ng-click='vm.<%=submitFunc%>'>Submit resource</button>
        </div>
        <div id='modal-warn' class='modal-footer' style="display: none;">
          <button type='button' class='btn btn-default' data-dismiss='modal'>Okay</button>
          <button type='button' class='btn btn-default' ng-click='vm.passWarning()'>Continue</button>
        </div>
      </div>
    </div>
  </div>
  <div id="MessageModal" class="modal fade" data-keyboard="false" data-backdrop="static" role="dialog">
  <div class="modal-dialog" role="document">
    <div class="modal-content">
      <div class="modal-header">
        <center>
          <h4 class="modal-title" id="messageLabel"></h4>
        </center>
      </div>
      <div class="modal-body" id="messageBody" style="text-align:center">
      </div>
      <div class='modal-footer' >
        <button type='button' class='btn btn-default' data-dismiss='modal'>Close</button>
      </div>
    </div>

  </div>
</div>
  <script type="text/ng-template" id="repeatSection.html">
    <div>
      <!--loop through each element in model array-->
      <div class="{{hideRepeat}}">
        <div class="repeatsection" ng-repeat="element in model[options.key]" ng-init="fields = copyFields(to.fields)">
          <hr style="border: 0; height: 1px;background: #333;background-image: linear-gradient(to right, #ccc, #333, #ccc);" />
          <formly-form fields="fields" model="element" form="form">
          </formly-form>
          <div style="margin-bottom:20px;">
            <br>
            <button type="button" class="btn btn-sm btn-danger pull-right" ng-click="model[options.key].splice($index, 1)">
              Remove
            </button>
            <br/>
          </div>
        </div>
        <p class="AddNewButton form-group ng-scope" ng-class="{'has-error': showError}">
          <button type="button" class="btn btn-secondary control-label" ng-click="addNew()">{{to.btnText}}{{to.required ? '*' : ''}}</button>
        </p>
        <hr style="border: 0; height: 1px;background: #333;background-image: linear-gradient(to right, #ccc, #333, #ccc);" />
      </div>
  </script>
  <script type="text/ng-template" id="datepicker.html">
    <p class="input-group">
      <input type="text" id="{{::id}}" name="{{::id}}" ng-model="model[options.key]" class="form-control" ng-click="datepicker.open($event)" datepicker-popup="{{to.datepickerOptions.format}}" is-open="datepicker.opened" datepicker-options="to.datepickerOptions"
      readonly/>
      <span class="input-group-btn">
        <button type="button" class="btn btn-default" ng-click="datepicker.open($event)" ng-disabled="to.disabled"><i class="glyphicon glyphicon-calendar"></i></button>
      </span>
    </p>
  </script>
  <script type="text/ng-template" id="typeahead-async.html">
  <div class="form-group ng-scope" ng-class="{'has-error': showError}">
    <label class="control-label">{{to.label}}{{to.required ? '*' : ''}}</label>
    <input type="text" class="form-control ng-pristine ng-invalid ng-valid-required ng-touched" ng-model="model[options.key]" placeholder="{{to.placeholder}}" uib-typeahead="item for item in getItems($viewValue, to.link)" typeahead-loading="loadingItems"
    typeahead-no-results="noResults" required>
    <i ng-show="loadingItems" class="glyphicon glyphicon-refresh"></i>
    <div ng-show="noResults">
      <i class="glyphicon glyphicon-remove"></i> No Results Found
    </div>
    </div>
  </script>
  <script type="text/ng-template" id="typeahead.html">
    <input type="text" ng-model="model[options.key]" uib-typeahead="item for item in to.options | filter:$viewValue | limitTo:8" class="form-control">
  </script>
  <script type="text/ng-template" id="tags.html">
    <label>{{to.label}}</label>
    <tags-input ng-model="model[options.key]">
      <auto-complete source="getItems($query, to.link, to.attr)"></auto-complete>
    </tags-input>
  </script>
  <script type="text/ng-template" id="error-messages.html">
      <formly-transclude></formly-transclude>
      <div ng-messages="fc.$error" ng-if="form.$submitted || options.formControl.$touched" class="error-messages">
        <div ng-message="{{ ::name }}" ng-repeat="(name, message) in ::options.validation.messages" class="message">{{ message(fc.$viewValue, fc.$modelValue, this)}}</div>
      </div>
  </script>
  <script type="text/ng-template" id="ui-select-single-async-search.html">
      <ui-select data-ng-model="model[options.key]" data-required="{{to.required}}" data-disabled="{{to.disabled}}" theme="bootstrap">

        <ui-select-match placeholder="{{to.placeholder}}">
        {{$select.selected[to.valueProp]|| model[to.otherProp]}} [{{$select.selected[to.labelProp]}}]

        </ui-select-match>
        <ui-select-choices data-repeat="{{to.ngOptions}}" data-refresh="to.refresh($select.search, options, to.endpoint)" data-refresh-delay="{{to.refreshDelay}}">
          <div ng-bind-html="option[to.labelProp] | highlight: $select.search"></div>
          <div><small>{{option[to.valueProp]}}</small></div>
        </ui-select-choices>
      </ui-select>
    </script>
</div>
</body>


<!-- Application Dependencies -->
<link href='https://fonts.googleapis.com/css?family=Open+Sans:400,300' rel='stylesheet' type='text/css'>
<script src="//npmcdn.com/api-check@latest/dist/api-check.js"></script>
<script src="//cdnjs.cloudflare.com/ajax/libs/angular.js/1.4.7/angular.min.js"></script>
<script type="text/javascript" src="/javascripts/register/ng-tags-input.min.js"></script>
<script src="//cdnjs.cloudflare.com/ajax/libs/angular-ui-bootstrap/0.14.3/ui-bootstrap-tpls.js"></script>
<script src="//npmcdn.com/angular-formly@7.5.2/dist/formly.js"></script>
<script src="//npmcdn.com/angular-formly-templates-bootstrap@latest/dist/angular-formly-templates-bootstrap.js"></script>
<script src="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.6/js/bootstrap.min.js"></script>
<script src="//cdnjs.cloudflare.com/ajax/libs/underscore.js/1.8.3/underscore-min.js"></script>
<script src="http://cdn.jsdelivr.net/jquery.validation/1.14.0/jquery.validate.min.js"></script>
<script src="https://rawgit.com/angular/bower-angular-messages/v1.4.4/angular-messages.js"></script>
<script src="https://ajax.googleapis.com/ajax/libs/angularjs/1.4.6/angular-sanitize.js"></script>


<script src="/javascripts/select.js"></script>
<link rel="stylesheet" href="/stylesheets/select.css">



<script src="<%=editURL%>/javascripts/register/typeahead.js"></script>
<script src="https://www.google.com/recaptcha/api.js"></script>


<!-- Application Scripts -->
<script src="<%=editURL%>/javascripts/register/app.js"></script>
<script src="<%=editURL%>/javascripts/register/MainController.js"></script>


</html>
